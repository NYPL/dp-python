<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Virtual Environments - NYPL DP Python Workshop</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Virtual Environments | NYPL DP Python Workshop</title> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="Virtual Environments" /> <meta property="og:locale" content="en_US" /> <link rel="canonical" href="http://localhost:4000/lessons/environment/2_virtualenvironments.html" /> <meta property="og:url" content="http://localhost:4000/lessons/environment/2_virtualenvironments.html" /> <meta property="og:site_name" content="NYPL DP Python Workshop" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Virtual Environments" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","headline":"Virtual Environments","url":"http://localhost:4000/lessons/environment/2_virtualenvironments.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> NYPL DP Python Workshop </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/lessons/rewrite_ftsh/overall.html" class="nav-list-link">Rewriting ft.sh</a><ul class="nav-list "><li class="nav-list-item "><a href="/lessons/rewrite_ftsh/0_testdrivendevelopment.html" class="nav-list-link">Test-driven Development</a></li><li class="nav-list-item "><a href="/lessons/rewrite_ftsh/1_argparse.html" class="nav-list-link">Creating a command-line script with arguments</a></li><li class="nav-list-item "><a href="/lessons/rewrite_ftsh/2_filepaths.html" class="nav-list-link">Manipulating file paths</a></li><li class="nav-list-item "><a href="/lessons/rewrite_ftsh/3_bagit.html" class="nav-list-link">Using bagit-python in Python</a></li><li class="nav-list-item "><a href="/lessons/rewrite_ftsh/4_subprocess.html" class="nav-list-link">Running shell commands</a></li><li class="nav-list-item "><a href="/lessons/rewrite_ftsh/5_scriptboilerplate.html" class="nav-list-link">Finishing the script</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/lessons/environment/overall.html" class="nav-list-link">Creating an Environment</a><ul class="nav-list "><li class="nav-list-item "><a href="/lessons/environment/3_editingcode.html" class="nav-list-link">Editing Code</a></li><li class="nav-list-item "><a href="/lessons/environment/1_shellandterminal.html" class="nav-list-link">Shell and Terminal</a></li><li class="nav-list-item "><a href="/lessons/environment/4_versioncontrol.html" class="nav-list-link">Version Control</a></li><li class="nav-list-item active"><a href="/lessons/environment/2_virtualenvironments.html" class="nav-list-link active">Virtual Environments</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search NYPL DP Python Workshop" aria-label="Search NYPL DP Python Workshop" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/lessons/environment/overall.html">Creating an Environment</a></li> <li class="breadcrumb-nav-list-item"><span>Virtual Environments</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h2 id="goals"> <a href="#goals" class="anchor-heading" aria-labelledby="goals"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Goals </h2> <ul> <li>Managing Python versions</li> <li>Managing Python modules</li> </ul> <h2 id="what-is-a-virtual-environment"> <a href="#what-is-a-virtual-environment" class="anchor-heading" aria-labelledby="what-is-a-virtual-environment"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What is a virtual environment </h2> <p>A shell session has an environment that includes many configurations. If you want to change that environment, you can alter those configurations for the duration of the session, customize your profile to create a new default environment, or load a different shell. None of these options work well if you want to repeatedly alter a part of the environment in the same way while retaining most of the existing environment.</p> <p>For example, you have a set of scripts that was written in Python 3.6 and another set that was written in Python 3.10. You don’t have the resources to update the Python 3.6 scripts right now, but you still need to use them. Ideally you would be able to do the following <code class="language-plaintext highlighter-rouge">python 3.6project/script.py</code> and <code class="language-plaintext highlighter-rouge">python 3.10project/script.py</code> and each would use the right version of Python.</p> <p>Or maybe you are working on a project using the <code class="language-plaintext highlighter-rouge">bagit-python</code> module, and new version came out. That new version has a feature that would make your day-to-day calls of <code class="language-plaintext highlighter-rouge">bagit.py</code> easier, but you also need some time to make sure that new version doesn’t break your project.</p> <p>This is what virtual environments are for. They give you the ability to create environments with all the right tools installed and that you can turn on and off as needed.</p> <p>There are a number of virtual environment managers. If you have used anaconda, you might be familiar with <code class="language-plaintext highlighter-rouge">conda</code>. You might have heard about the Python <code class="language-plaintext highlighter-rouge">virtualenv</code> module. In Ruby contexts, <code class="language-plaintext highlighter-rouge">rbenv</code> is very common.</p> <p>For this lesson, we’re using a combination of two tools, <code class="language-plaintext highlighter-rouge">pyenv</code> and <code class="language-plaintext highlighter-rouge">pyenv-virtualenv</code>. They combine very nice features of <code class="language-plaintext highlighter-rouge">rbenv</code> and <code class="language-plaintext highlighter-rouge">virtualenv</code>. From <code class="language-plaintext highlighter-rouge">rbenv</code>, we get the ability to install multiple versions of Python and to associate any working directory with a specific version.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pyenv global 3.9.4
<span class="nb">cd </span>path/to/project/dir
pyenv <span class="nb">local </span>3.7.13
python <span class="nt">-V</span>
<span class="o">&gt;</span> 3.7.13
<span class="nb">cd</span> ../
python <span class="nt">-V</span>
<span class="o">&gt;</span> 3.9.4
</code></pre></div></div> <p>That means that once a version of Python is configured for a folder, we don’t have to do anything extra as long as we are working within that directory. In other virtual environments, you might have to run code like <code class="language-plaintext highlighter-rouge">source venv/bin/activate</code>.</p> <p>We can also quickly change between versions quickly.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pyenv <span class="nb">local </span>3.7.13
python script.py
<span class="c"># script works as expected</span>
pyenv <span class="nb">local </span>3.9.4
python script.py
<span class="c"># script returns an error that we'll need to address to upgrade to 3.9.4</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">python-virtualenv</code> adds module management to the mix. If we need a specific version of a module for a project, we can create a virtualenv associated just to the project’s directory.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>bagit
<span class="nb">cd </span>path/to/project/dir
pyenv virtualenv 3.7.13 project-env
pyenv <span class="nb">local </span>project-env
pip <span class="nb">install </span><span class="nv">bagit</span><span class="o">==</span>1.6.1
pip list
<span class="o">&gt;</span> ...
<span class="o">&gt;</span> awscli        1.6.1
<span class="o">&gt;</span> ...
<span class="nb">cd</span> ../
pip list
<span class="o">&gt;</span> ...
<span class="o">&gt;</span> awscli        1.8.1
<span class="o">&gt;</span> ...
</code></pre></div></div> <p>There is a learning curve to using virtual environments. They can require that you change some of your typical practices. If you often call scripts from another working directory, e.g. <code class="language-plaintext highlighter-rouge">python ~/dev/project-dir/script.py</code>, you might need to change that practice. If you forget which virtual environment you’re using, you’ll probably become very practiced at running <code class="language-plaintext highlighter-rouge">python -V</code> or <code class="language-plaintext highlighter-rouge">pyenv local</code>.</p> <p>Once virtual environments feel familiar, they might become part of your default project start-up.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>new-project
<span class="nb">cd </span>new-project
pyenv virtualenv 3.9.4 new-project-env
...
</code></pre></div></div> <p>But to use them, we need to install the tools.</p> <h2 id="install-pyenv-and-pyenv-virtualenv"> <a href="#install-pyenv-and-pyenv-virtualenv" class="anchor-heading" aria-labelledby="install-pyenv-and-pyenv-virtualenv"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Install <code class="language-plaintext highlighter-rouge">pyenv</code> and <code class="language-plaintext highlighter-rouge">pyenv-virtualenv</code> </h2> <p>The most up-to-date installation directions are available on the <a href="https://github.com/pyenv/pyenv#installation"><code class="language-plaintext highlighter-rouge">pyenv</code></a> and <a href="https://github.com/pyenv/pyenv-virtualenv#installation"><code class="language-plaintext highlighter-rouge">pyenv-virtualenv</code></a> GitHub repos. This section presents one method installing the tools to demonstrate ideas from the previous lesson.</p> <h3 id="install-via-homebrew"> <a href="#install-via-homebrew" class="anchor-heading" aria-labelledby="install-via-homebrew"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Install via homebrew </h3> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>pyenv pyenv-virtualenv
</code></pre></div></div> <h3 id="configure-your-shell-profile"> <a href="#configure-your-shell-profile" class="anchor-heading" aria-labelledby="configure-your-shell-profile"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configure your shell profile </h3> <p>In order for <code class="language-plaintext highlighter-rouge">pyenv</code> to pull up the correct version of Python, it needs to be part of the <code class="language-plaintext highlighter-rouge">PATH</code>. The program also needs to be initialized whenever you start a new session. Both of these are functions that can be run from a profile.</p> <p>Open your profile in code, <code class="language-plaintext highlighter-rouge">code ~/.profile</code> and add the following if it has not been added already.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Configure pyenv</span>
<span class="nb">export </span><span class="nv">PYENV_ROOT</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.pyenv"</span>
<span class="nb">command</span> <span class="nt">-v</span> pyenv <span class="o">&gt;</span>/dev/null <span class="o">||</span> <span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PYENV_ROOT</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
<span class="nb">eval</span> <span class="s2">"</span><span class="si">$(</span>pyenv init -<span class="si">)</span><span class="s2">"</span>
</code></pre></div></div> <p>Save and close the profile.</p> <h3 id="test-the-installation"> <a href="#test-the-installation" class="anchor-heading" aria-labelledby="test-the-installation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Test the installation </h3> <p>Open a new shell session and see if <code class="language-plaintext highlighter-rouge">pyenv</code> is correctly configured by running some of its commands.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pyenv versions
<span class="o">&gt;</span> system
pyenv global
<span class="o">&gt;</span> system
</code></pre></div></div> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
